<div class="container py-5">
  <div class="row">
    <div class="col-lg-8">
      <!-- Post Content -->
      <article class="card fade-in-up">
        <div class="card-body">
          <header class="mb-4">
            <h1 class="post-card-title mb-3"><%= @post.title %></h1>

            <div class="post-card-meta">
              <span class="post-card-author">
                <%= @post.user.display_name %>
              </span>
              <span class="post-card-date">
                <%= @post.created_at.strftime("%B %d, %Y") %>
              </span>
              <span class="post-card-status <%= @post.status %>">
                <%= @post.status %>
              </span>
            </div>
          </header>

          <div class="post-content">
            <%= simple_format(@post.body, class: "lead") %>
          </div>

          <% if user_signed_in? && @post.user == current_user %>
            <div class="mt-4 pt-4 border-top">
              <h5>Post Actions</h5>
              <div class="d-flex gap-2">
                <%= link_to "✏️ Edit Post", edit_post_path(@post), class: "btn btn-primary" %>
                <%= link_to "🗑️ Delete Post", post_path(@post),
                    method: :delete,
                    data: { confirm: "Are you sure you want to delete this post?" },
                    class: "btn btn-danger" %>
              </div>
            </div>
          <% end %>
        </div>
      </article>

      <!-- Comments Section -->
      <section class="comment-section mt-4">
        <h3>💬 Comments (<%= @comments.count %>)</h3>

        <% if user_signed_in? %>
          <div class="card mb-4">
            <div class="card-body">
              <%= form_with model: [@post, @comment], local: true do |f| %>
                <div class="mb-3">
                  <%= f.label :content, "Add a comment", class: "form-label" %>
                  <%= f.text_area :content, class: "form-control", rows: 4,
                      placeholder: "Share your thoughts on this post..." %>
                </div>
                <%= f.submit "Post Comment", class: "btn btn-primary" %>
              <% end %>
            </div>
          </div>
        <% else %>
          <div class="alert alert-info">
            <strong>Want to join the conversation?</strong>
            Please <%= link_to "sign in", new_user_session_path, class: "alert-link" %> to leave a comment.
          </div>
        <% end %>

        <!-- Comments List -->
        <div class="comments-list">
          <% if @comments.any? %>
            <% @comments.each do |comment| %>
              <div class="comment slide-in-left">
                <div class="comment-header">
                  <span class="comment-author"><%= comment.author_name %></span>
                  <span class="comment-date"><%= time_ago_in_words(comment.created_at) %> ago</span>
                </div>
                <div class="comment-content">
                  <%= simple_format(comment.content) %>
                </div>
                <% if user_signed_in? && comment.user == current_user %>
                  <div class="mt-2">
                    <%= link_to "🗑️ Delete", post_comment_path(@post, comment),
                        method: :delete,
                        data: { confirm: "Are you sure?" },
                        class: "btn btn-outline-danger btn-sm" %>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="text-center py-4">
              <p class="text-muted">No comments yet. Be the first to share your thoughts!</p>
            </div>
          <% end %>
        </div>
      </section>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- Author Info -->
      <div class="card mb-4">
        <div class="card-header">
          <h5>👤 About the Author</h5>
        </div>
        <div class="card-body text-center">
          <div class="mb-3">
            <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center"
                 style="width: 60px; height: 60px; font-size: 1.5rem;">
              <%= @post.user.display_name.first.upcase %>
            </div>
          </div>
          <h6 class="mb-1"><%= @post.user.display_name %></h6>
          <p class="text-muted mb-2">Member since <%= @post.user.created_at.strftime("%B %Y") %></p>
          <div class="d-flex justify-content-center gap-2">
            <span class="badge badge-primary"><%= @post.user.posts.count %> posts</span>
            <span class="badge badge-success"><%= @post.user.comments.count %> comments</span>
          </div>
        </div>
      </div>

      <!-- Recent Posts -->
      <div class="card mb-4">
        <div class="card-header">
          <h5>📖 Recent Posts</h5>
        </div>
        <div class="card-body">
          <% Post.published.where.not(id: @post.id).limit(5).each do |recent_post| %>
            <div class="d-flex align-items-start mb-3">
              <div class="flex-grow-1">
                <h6 class="mb-1">
                  <%= link_to recent_post.title, post_path(recent_post),
                      class: "text-decoration-none" %>
                </h6>
                <small class="text-muted">
                  by <%= recent_post.user.display_name %> •
                  <%= time_ago_in_words(recent_post.created_at) %> ago
                </small>
              </div>
            </div>
            <% unless recent_post == Post.published.where.not(id: @post.id).limit(5).last %>
              <hr class="my-3">
            <% end %>
          <% end %>
        </div>
      </div>

      <!-- Post Stats -->
      <div class="card">
        <div class="card-header">
          <h5>📊 Post Statistics</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <div class="stat-number"><%= @comments.count %></div>
              <div class="stat-label">Comments</div>
            </div>
            <div class="col-6">
              <div class="stat-number"><%= @post.created_at.strftime("%d") %></div>
              <div class="stat-label">Day Published</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
